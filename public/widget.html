<!DOCTYPE html>  <html lang="en">  
<head>  
<meta charset="UTF-8" />  
<title>Finance Alerts</title>  <style>  
html, body {  
  margin: 0;  
  padding: 0;  
  width: 100%;  
  height: 100%;  
  background: transparent; /* allow Notion to show through */  
  overflow: hidden;  
  font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, sans-serif;  
  color: #eaeaea;  
}  
  
/* ===== SAFE ZONE (MATCHES REACTOR) ===== */  
.safe-zone {  
  position: absolute;  
  inset: 0;  
  overflow: hidden;  
  
  /* ðŸ”‘ EXACT reactor-style flat base */  
  background: rgba(16,16,16,0.96);  
     
}  
  
/* ===== CONTENT PADDING (NOT CONTAINER) ===== */  
#content {  
  padding: 18px 16px;  
  box-sizing: border-box;  
}  
  
/* ===== SECTIONS ===== */  
.section {  
  margin-top: 14px;  
}  
.section-title {  
  font-size: 11px;  
  letter-spacing: 0.08em;  
  opacity: 0.6;  
  margin-bottom: 6px;  
}  
  
/* ===== ITEMS ===== */  
.item {  
  display: flex;  
  justify-content: space-between;  
  align-items: center;  
  padding: 10px 12px;  
  border-radius: 12px;  
  margin-bottom: 8px;  
  
  background: rgba(255,255,255,0.04);  
  box-shadow:  
    inset 0 0 0 1px rgba(255,255,255,0.03),  
    inset 0 0 18px rgba(0,0,0,0.5);  
}  
  
.item.overdue {  
  background: linear-gradient(  
    90deg,  
    rgba(180,60,60,0.28),  
    rgba(255,255,255,0.04)  
  );  
}  
.item.due {  
  background: linear-gradient(  
    90deg,  
    rgba(220,150,60,0.24),  
    rgba(255,255,255,0.04)  
  );  
}  
.item.paid {  
  background: rgba(120,160,140,0.18);  
}  
  
/* ===== TEXT ===== */  
.item-left {  
  display: flex;  
  flex-direction: column;  
  gap: 2px;  
}  
.item-title {  
  font-size: 13px;  
  font-weight: 500;  
}  
.item-sub {  
  font-size: 11px;  
  opacity: 0.7;  
}  
.item-right {  
  font-size: 13px;  
  font-weight: 500;  
  opacity: 0.9;  
}  
  
/* ===== PAYMENTS ===== */  
.payment-day {  
  margin-top: 10px;  
}  
.payment-label {  
  font-size: 11px;  
  opacity: 0.5;  
  margin-bottom: 6px;  
}  
</style>  </head>  <body>  
<div class="safe-zone">  
  <div id="content"></div>  
</div>  <script>  
async function loadData() {  
  const res = await fetch("/api/widget/view", { cache: "no-store" });  
  const data = await res.json();  
  render(data);  
}  
  
function el(tag, cls, txt) {  
  const e = document.createElement(tag);  
  if (cls) e.className = cls;  
  if (txt) e.textContent = txt;  
  return e;  
}  

function formatDate(d) {
  if (!d) return "";
  return new Date(d).toLocaleDateString("en-GB", {
    day: "2-digit",
    month: "short",
    year: "numeric"
  });
}

function paymentSVG(method = "") {
  const m = method.toLowerCase();

  if (m.includes("gpay")) {
    return `
      <svg width="12" height="12" viewBox="0 0 48 48" style="vertical-align:-2px">
        <path fill="#4285F4" d="M24 9.5c3.2 0 5.4 1.4 6.6 2.6l4.5-4.5C32.2 5 28.5 3.5 24 3.5"/>
        <path fill="#34A853" d="M46.1 24.5c0-1.5-.1-2.6-.4-3.8H24v7.2h12.5"/>
        <path fill="#FBBC05" d="M10.3 28.3c-.5-1.5-.8-3-.8-4.8"/>
        <path fill="#EA4335" d="M24 44.5c6.5 0 12-2.1 16-5.7"/>
      </svg> GPay
    `;
  }

  if (m.includes("paytm")) {
    return `
      <svg width="32" height="12" viewBox="0 0 420 140" style="vertical-align:-2px">
        <text x="0" y="100"
          font-size="96"
          font-family="Arial, Helvetica, sans-serif"
          font-weight="700"
          fill="#00BAF2">PAYTM</text>
      </svg>
    `;
  }

  return method;
}
  
  
function render(view) {  
  const root = document.getElementById("content");  
  const cards = view.cards;  
  
  function renderCardSection(title, items, cls) {  
    if (!items.length) return;  
    const sec = el("div", "section");  
    sec.appendChild(el("div", "section-title", title));  
    items.forEach(i => {  
      const row = el("div", `item ${cls}`);  
      const left = el("div", "item-left");  
      left.appendChild(el("div", "item-title", `${i.provider} â€¢ ${i.last4}`));  
     let sub = "";

if (cls === "paid") {
  const d = formatDate(i.paid_at);
  const m = i.payment_method;
  sub = m ? `${d} | ` : d;
  left.appendChild(el("div", "item-sub"));
  left.lastChild.innerHTML = m ? `${d} | ${paymentSVG(m)}` : d;
} else {
  left.appendChild(el("div", "item-sub", i.rules.status_label));
}
      const right = el("div", "item-right", i.amount_due ? `â‚¹${i.amount_due}` : "");  
      row.append(left, right);  
      sec.appendChild(row);  
    });  
    root.appendChild(sec);  
  }  
  
  renderCardSection("OVERDUE", cards.overdue, "overdue");  
  renderCardSection("DUE", cards.due, "due");  
  renderCardSection(  
    "PAID",  
    cards.paid.filter(i => i.rules.visibility === "visible"),  
    "paid"  
  );  
  
  const payments = view.payments;  
  const days = Object.keys(payments);  
  
  if (days.length) {  
    const sec = el("div", "section");  
    sec.appendChild(el("div", "section-title", "PAYMENTS"));  
  
    days.forEach(day => {  
      const group = el("div", "payment-day");  
      group.appendChild(el("div", "payment-label", payments[day].label));  
  
      payments[day].items.forEach(p => {  
        const row = el("div", "item paid");  
        const left = el("div", "item-left");  
        left.appendChild(el("div", "item-title", `${p.provider || "Payment"}`));  
        left.appendChild(el("div", "item-sub", p.display_name || p.identifier || ""));  
        const right = el("div", "item-right", p.value ? `â‚¹${p.value}` : "");  
        row.append(left, right);  
        group.appendChild(row);  
      });  
  
      sec.appendChild(group);  
    });  
  
    root.appendChild(sec);  
  }  
}  
  
loadData();  
</script>  </body>  
</html>
